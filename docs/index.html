<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ull-esit-inf-dsi-22-23-prct09-funko-app-DanielFelipeGomez</title><meta name="description" content="Documentation for ull-esit-inf-dsi-22-23-prct09-funko-app-DanielFelipeGomez"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">ull-esit-inf-dsi-22-23-prct09-funko-app-DanielFelipeGomez</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>ull-esit-inf-dsi-22-23-prct09-funko-app-DanielFelipeGomez</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#práctica-10---apis-asíncronas-de-gestión-del-sistema-de-ficheros-creación-de-procesos-y-creación-de-sockets-de-nodejs" id="práctica-10---apis-asíncronas-de-gestión-del-sistema-de-ficheros-creación-de-procesos-y-creación-de-sockets-de-nodejs" style="color: inherit; text-decoration: none;">
  <h1>Práctica 10 - APIs asíncronas de gestión del sistema de ficheros, creación de procesos y creación de sockets de Node.js</h1>
</a>

<a href="#desarrollado-por-daniel-felipe-gomez-aristizabal" id="desarrollado-por-daniel-felipe-gomez-aristizabal" style="color: inherit; text-decoration: none;">
  <h2>Desarrollado por Daniel Felipe Gomez Aristizabal</h2>
</a>

<a href="#indice" id="indice" style="color: inherit; text-decoration: none;">
  <h2>Indice</h2>
</a>
<ol>
<li><p><a href="#introducci%C3%B3n">Introducción</a></p>
</li>
<li><p><a href="#hablemos-de-sockets">Hablemos de Sockets</a></p>
</li>
<li><p><a href="#ejercicio-1">Ejercicio 1</a></p>
</li>
<li><p><a href="#ejercicio-2">Ejercicio 2</a></p>
</li>
<li><p><a href="#ejercicio-3">Ejercicio 3</a></p>
</li>
<li><p><a href="#ejercicio-pe">Ejercicio PE</a></p>
</li>
<li><p><a href="#conclusiones">Conclusiones</a></p>
</li>
<li><p><a href="#referencias">Referencias</a></p>
</li>
</ol>

<a href="#introducción" id="introducción" style="color: inherit; text-decoration: none;">
  <h2>Introducción</h2>
</a>
<p>En presente práctica se pretende mejorar el manejo de ficheros y aprender a crear procesos y sockets en Node.js. Para ello se realizarán tres ejercicios que se explicarán a continuación. Previamente a hacer esta práctica hice el ejercicio del PE, considero que gracias al estrés que pasé en ese ejercicio, el desarrollo de los demás fue relativamente fluido.</p>

<a href="#hablemos-de-sockets" id="hablemos-de-sockets" style="color: inherit; text-decoration: none;">
  <h2>Hablemos de Sockets</h2>
</a>
<p>Los Sockets a lo largo de la carrera siempre fue un tema que evite bastante, en definitiva en esta asignatura se tiene una visión más útil de los mismos y su manipulación es relativamente menos compleja, ya que en otras ocasiones se nos hacia elegir hasta los protocolos de transferencia. </p>
<p>Para poder entenderlos un poco me fue util hacer uso de los apuntes de la asignatura <a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/nodejs-sockets.html">Sockets</a>, además de luchar un buen rato con el código para intentar entenderlo. Al final una vez que se controla el hecho de pasar la información de un lado a otro sin muchos problemas, es cuestión de ir probando y añadiendo los elementos que nos interesan.</p>

<a href="#ejercicio-1" id="ejercicio-1" style="color: inherit; text-decoration: none;">
  <h2>Ejercicio 1</h2>
</a>
<p>Se nos pide considera el siguiente código:</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">access</span><span class="hl-1">, </span><span class="hl-2">constants</span><span class="hl-1">, </span><span class="hl-2">watch</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;fs&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> !== </span><span class="hl-4">3</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Please, specify a file&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">filename</span><span class="hl-1"> = </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-4">2</span><span class="hl-1">];</span><br/><br/><span class="hl-1">  </span><span class="hl-5">access</span><span class="hl-1">(</span><span class="hl-2">filename</span><span class="hl-1">, </span><span class="hl-2">constants</span><span class="hl-1">.</span><span class="hl-7">F_OK</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`File </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3"> does not exist`</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Starting to watch file </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">watcher</span><span class="hl-1"> = </span><span class="hl-5">watch</span><span class="hl-1">(</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-4">2</span><span class="hl-1">]);</span><br/><br/><span class="hl-1">      </span><span class="hl-2">watcher</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;change&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`File </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3"> has been modified somehow`</span><span class="hl-1">);</span><br/><span class="hl-1">      });</span><br/><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`File </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3"> is no longer watched`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Para entender un poco mejor como funciona la ejecución de elementos sincronos y asincronos, es util hacer una traza de la ejecución del código:</p>
<ol>
<li><p>Se importan los elementos necesarios para el ejercicio.</p>
</li>
<li><p>Se comprueba que se ha pasado un argumento, en caso contrario se muestra un mensaje de error.</p>
</li>
<li><p>Se comprueba que el archivo existe, en caso contrario se muestra un mensaje de error.</p>
</li>
<li><p>Se muestra un mensaje de que se ha iniciado la observación del archivo.</p>
</li>
<li><p>Se crea un watcher para el archivo.</p>
</li>
<li><p>El watcher queda pendiente a los cambios que ocurran en el archivo.</p>
</li>
<li><p>Se muestra un mensaje de que el archivo ya no se está observando.</p>
</li>
<li><p>En el momento que ocurra un cambio en el archivo, se muestra un mensaje de que el archivo ha sido modificado.</p>
</li>
<li><p>El paso anterior continua hasta que se detenga la ejecución del programa.</p>
</li>
</ol>
<p>Si ahora lo vemos de forma más detallada, pensando a nivel de las estructuras de datos, podemos ver que el código se ejecuta de la siguiente forma:</p>
<ol>
<li><p>A la pila de llamadas se añade el console.log(&#39;Starting to watch file ${filename}&#39;);.</p>
</li>
<li><p>Se ejecuta el console.log(&#39;Starting to watch file ${filename}&#39;);.</p>
</li>
<li><p>Se añade el watcher.on(&#39;change&#39;, () =&gt; {console.log(<code>File ${filename} has been modified somehow</code>);}); a la pila de llamadas.</p>
</li>
<li><p>Se debe añadir el watcher.on(&#39;change&#39;, () =&gt; {console.log(<code>File ${filename} has been modified somehow</code>);}); al registro de eventos de ka API.</p>
</li>
<li><p>Se añade el console.log(<code>File ${filename} is no longer watched</code>); a la pila de llamadas.</p>
</li>
<li><p>Se ejecuta el console.log(<code>File ${filename} is no longer watched</code>);.</p>
</li>
<li><p>Cuando se produce un cambio en el archivo, se añade el console.log(<code>File ${filename} has been modified somehow</code>); a la cola de manejadores.</p>
</li>
<li><p>Cuando se encuentra vacía la pila de llamadas, se ejecuta el watcher.on(&#39;change&#39;, () =&gt; {console.log(<code>File ${filename} has been modified somehow</code>);});.</p>
</li>
<li><p>Se ejecuta el console.log(<code>File ${filename} has been modified somehow</code>);.</p>
</li>
<li><p>El paso 7-9 se repite hasta que se detiene la ejecución del programa.</p>
</li>
</ol>

<a href="#ejercicio-2" id="ejercicio-2" style="color: inherit; text-decoration: none;">
  <h2>Ejercicio 2</h2>
</a>
<p>En el ejercicio 2 debíamos desarrollar un programa que nos diera información de un fichero dado por parámetro. Para ello se nos pide que el programa sea capaz de:</p>
<ul>
<li><p>Mostrar el número de líneas del fichero.</p>
</li>
<li><p>Mostrar el número de palabras del fichero.</p>
</li>
<li><p>Mostrar el número de caracteres del fichero.</p>
</li>
</ul>
<p>Esta información la pide el usuario mediante línea de comandos y puede pedir solo una de las opciones o todas. Debemos conseguir dicho funcionamiento haciendo uso de <strong>pipes</strong> para una versión del programa y otra sin usar <strong>pipes</strong>.</p>

<a href="#versión-con-pipes" id="versión-con-pipes" style="color: inherit; text-decoration: none;">
  <h3>Versión con pipes</h3>
</a>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">spawn</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;child_process&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">net</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;net&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-8">InformacionFicheroPipe</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-2">out</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-2">mensaje</span><span class="hl-1">: </span><span class="hl-8">any</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">constructor</span><span class="hl-1">() {</span><br/><br/><span class="hl-1">        </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">i</span><span class="hl-1"> = </span><span class="hl-4">2</span><span class="hl-1">; </span><span class="hl-2">i</span><span class="hl-1"> &lt; </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> -</span><span class="hl-4">1</span><span class="hl-1">; </span><span class="hl-2">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">            </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">comando</span><span class="hl-1"> = </span><span class="hl-5">spawn</span><span class="hl-1">(</span><span class="hl-3">&#39;wc&#39;</span><span class="hl-1">, [</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">i</span><span class="hl-1">], </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> - </span><span class="hl-4">1</span><span class="hl-1">]])</span><br/><span class="hl-1">            </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">i</span><span class="hl-1">] === </span><span class="hl-3">&#39;-l&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;lineas&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">i</span><span class="hl-1">] === </span><span class="hl-3">&#39;-w&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;palabras&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">i</span><span class="hl-1">] === </span><span class="hl-3">&#39;-c&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;caracteres&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Comando incorrecto: </span><span class="hl-6">${</span><span class="hl-2">process</span><span class="hl-9">.</span><span class="hl-2">argv</span><span class="hl-9">[</span><span class="hl-2">i</span><span class="hl-9">]</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">            </span><span class="hl-2">comando</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">.</span><span class="hl-5">pipe</span><span class="hl-1">(</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">)</span><br/><span class="hl-1">            </span><span class="hl-2">comando</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;error&#39;</span><span class="hl-1">, (</span><span class="hl-2">error</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Comando incorrecto: </span><span class="hl-6">${</span><span class="hl-2">error</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">client</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-5">InformacionFicheroPipe</span><span class="hl-1">();</span><br/>
</code></pre>
<p>Como podemos ver hice una clase bastante sencilla la cual en su constructor recorre los argumentos pasados por el usuario y para cada uno prueba a crear un <strong>ChildProcess</strong>, en caso de que el comando sea correcto, se ejecuta y se muestra la información por pantalla, esto redirige la salida del comando a la salida estándar del proceso padre, en este caso la consola. En caso de que el comando sea incorrecto, se muestra un mensaje de error, con el comando que ha fallado.</p>
<p>Simplemente destacar que el fichero hice que recorra desde el segundo argumentos hasta el penúltimo, ya que el último argumento es el fichero que se quiere analizar, y para cada uno voy creando un <strong>ChildProcess</strong> del comando <strong>wc</strong> con la respectiva opción recuperada de la linea de comandos. También mencionar que añadí un bloque de <strong>if else</strong> para controlar las 3 opciones que se pueden pasar por línea de comandos, en caso de que no sea ninguna de las 3, se muestra un mensaje de error. </p>

<a href="#versión-sin-pipes" id="versión-sin-pipes" style="color: inherit; text-decoration: none;">
  <h3>Versión sin pipes</h3>
</a>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">spawn</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;child_process&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">net</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;net&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-8">InformacionFichero</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-2">out</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-2">mensaje</span><span class="hl-1">: </span><span class="hl-8">any</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">constructor</span><span class="hl-1">() {</span><br/><br/><span class="hl-1">        </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">i</span><span class="hl-1"> = </span><span class="hl-4">2</span><span class="hl-1">; </span><span class="hl-2">i</span><span class="hl-1"> &lt; </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> - </span><span class="hl-4">1</span><span class="hl-1">; </span><span class="hl-2">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">            </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">comando</span><span class="hl-1"> = </span><span class="hl-5">spawn</span><span class="hl-1">(</span><span class="hl-3">&#39;wc&#39;</span><span class="hl-1">, [</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">i</span><span class="hl-1">], </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> - </span><span class="hl-4">1</span><span class="hl-1">]])</span><br/><span class="hl-1">            </span><span class="hl-2">comando</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">piece</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1"> += </span><span class="hl-2">piece</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-2">comando</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;error&#39;</span><span class="hl-1">, (</span><span class="hl-2">error</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">error</span><span class="hl-1">)</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            </span><span class="hl-2">comando</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;close&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">i</span><span class="hl-1">] === </span><span class="hl-3">&#39;-l&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Lineas: </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">out</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">                } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">i</span><span class="hl-1">] === </span><span class="hl-3">&#39;-w&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Palabras: </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">out</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">                } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">i</span><span class="hl-1">] === </span><span class="hl-3">&#39;-c&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Caracteres: </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">out</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">                } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Comando incorrecto: </span><span class="hl-6">${</span><span class="hl-2">process</span><span class="hl-9">.</span><span class="hl-2">argv</span><span class="hl-9">[</span><span class="hl-2">i</span><span class="hl-9">]</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">                </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">client</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-5">InformacionFichero</span><span class="hl-1">();</span><br/>
</code></pre>
<p>Nuevamente desarrolle una clase sencilla, que en el constructor se encarga de generar un <strong>ChildProcess</strong> para cada uno de los argumentos pasados por el usuario. En este caso hace seguimiento al evento <strong>data</strong> del <strong>stdout</strong> del <strong>ChildProcess</strong>, para ir guardando la salida del comando en una variable. Cuando el proceso termina se emite el evento <strong>close</strong>, en el manejador de este evento se encarga de mostrar la información por pantalla, en caso de que el comando sea incorrecto, se muestra un mensaje de error, con el comando que ha fallado.</p>
<p>En definitiva haciendo uso de los manejadores es mucho más manipulable la información que conseguimos de un proceso hijo, ya que podemos ir guardando la información en una variable y cuando el proceso termine, podemos hacer lo que queramos con esa información, en este caso mostrarla por pantalla.</p>

<a href="#ejercicio-3" id="ejercicio-3" style="color: inherit; text-decoration: none;">
  <h2>Ejercicio 3</h2>
</a>
<p>Para el último ejercicio de la práctica, debíamos desarrollar un programa que se apoyaba de la práctica anterior de FunkoPop, la idea era crear un sistema cliente-servidor que nos permitiera consultar la información de los FunkoPops que tenemos en la base de datos, de la misma forma que lo hacíamos en la práctica anterior, pero esta vez a través de un servidor.</p>
<p>Para conseguir esto, desarrolle una clase Servidor y otra Cliente, para establecer la comunicación entre ambos.</p>

<a href="#servidor" id="servidor" style="color: inherit; text-decoration: none;">
  <h3>Servidor</h3>
</a>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">net</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;net&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">watchFile</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">spawn</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;child_process&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">TipoPregunta</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;./types/tipo_pregunta.js&#39;</span><span class="hl-1">;</span><br/><br/><br/><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-8">Servidor</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-2">out</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-2">mensaje</span><span class="hl-1">: </span><span class="hl-8">any</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-2">outColor</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">constructor</span><span class="hl-1">(</span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-2">server</span><span class="hl-1"> = </span><span class="hl-2">net</span><span class="hl-1">.</span><span class="hl-5">createServer</span><span class="hl-1">((</span><span class="hl-2">connection</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;A client has connected.&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">        </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-1">        </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">comando</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">wholeData</span><span class="hl-1"> += </span><span class="hl-2">comando</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">indexOf</span><span class="hl-1">(</span><span class="hl-3">&#39;</span><span class="hl-10">\n</span><span class="hl-3">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-0">while</span><span class="hl-1"> (</span><span class="hl-2">messageLimit</span><span class="hl-1"> !== -</span><span class="hl-4">1</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">(</span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">substring</span><span class="hl-1">(</span><span class="hl-4">0</span><span class="hl-1">, </span><span class="hl-2">messageLimit</span><span class="hl-1">).</span><span class="hl-5">toString</span><span class="hl-1">());</span><br/><span class="hl-1">                </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">substring</span><span class="hl-1">(</span><span class="hl-2">messageLimit</span><span class="hl-1"> + </span><span class="hl-4">1</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1"> !== </span><span class="hl-3">&#39;add&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1"> !== </span><span class="hl-3">&#39;update&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1"> !== </span><span class="hl-3">&#39;delete&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1"> !== </span><span class="hl-3">&#39;read&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1"> !== </span><span class="hl-3">&#39;list&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><span class="hl-3">&#39;requestType&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-3">&#39;error&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;success&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-3">&#39;error&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;request&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-3">&#39;Comando no reconocido&#39;</span><span class="hl-1">}) + </span><span class="hl-3">&quot;</span><span class="hl-10">\n</span><span class="hl-3">&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">                </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">comando</span><span class="hl-1"> = </span><span class="hl-5">spawn</span><span class="hl-1">(</span><span class="hl-3">&#39;node&#39;</span><span class="hl-1">, [</span><span class="hl-3">&#39;dist/ejercicio-3/index.js&#39;</span><span class="hl-1">, </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1">, ...</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">args</span><span class="hl-1">]);</span><br/><span class="hl-1">                </span><span class="hl-2">comando</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">piece</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1"> += </span><span class="hl-2">piece</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-2">comando</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;close&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">emit</span><span class="hl-1">(</span><span class="hl-3">&#39;request&#39;</span><span class="hl-1">);               </span><br/><span class="hl-1">                })</span><br/><span class="hl-1">                </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">indexOf</span><span class="hl-1">(</span><span class="hl-3">&#39;</span><span class="hl-10">\n</span><span class="hl-3">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        })</span><br/><br/><span class="hl-1">        </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;request&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1"> === </span><span class="hl-3">&#39;add&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><span class="hl-3">&#39;requestType&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1">, </span><span class="hl-3">&#39;success&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1">.</span><span class="hl-5">split</span><span class="hl-1">(</span><span class="hl-3">&#39;:&#39;</span><span class="hl-1">)[</span><span class="hl-4">0</span><span class="hl-1">], </span><span class="hl-3">&#39;idFunko&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1">.</span><span class="hl-5">split</span><span class="hl-1">(</span><span class="hl-3">&#39;:&#39;</span><span class="hl-1">)[</span><span class="hl-4">1</span><span class="hl-1">]}) + </span><span class="hl-3">&quot;</span><span class="hl-10">\n</span><span class="hl-3">&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1"> === </span><span class="hl-3">&#39;update&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><span class="hl-3">&#39;requestType&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1">, </span><span class="hl-3">&#39;success&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1">.</span><span class="hl-5">split</span><span class="hl-1">(</span><span class="hl-3">&#39;:&#39;</span><span class="hl-1">)[</span><span class="hl-4">0</span><span class="hl-1">], </span><span class="hl-3">&#39;idFunko&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1">.</span><span class="hl-5">split</span><span class="hl-1">(</span><span class="hl-3">&#39;:&#39;</span><span class="hl-1">)[</span><span class="hl-4">1</span><span class="hl-1">]}) + </span><span class="hl-3">&quot;</span><span class="hl-10">\n</span><span class="hl-3">&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1"> === </span><span class="hl-3">&#39;delete&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><span class="hl-3">&#39;requestType&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1">, </span><span class="hl-3">&#39;success&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1">.</span><span class="hl-5">split</span><span class="hl-1">(</span><span class="hl-3">&#39;:&#39;</span><span class="hl-1">)[</span><span class="hl-4">0</span><span class="hl-1">], </span><span class="hl-3">&#39;idFunko&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1">.</span><span class="hl-5">split</span><span class="hl-1">(</span><span class="hl-3">&#39;:&#39;</span><span class="hl-1">)[</span><span class="hl-4">1</span><span class="hl-1">]}) + </span><span class="hl-3">&quot;</span><span class="hl-10">\n</span><span class="hl-3">&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1"> === </span><span class="hl-3">&#39;read&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><span class="hl-3">&#39;requestType&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1">, </span><span class="hl-3">&#39;success&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1">.</span><span class="hl-5">split</span><span class="hl-1">(</span><span class="hl-3">&#39;:&#39;</span><span class="hl-1">)[</span><span class="hl-4">0</span><span class="hl-1">], </span><span class="hl-3">&#39;request&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1">}) + </span><span class="hl-3">&quot;</span><span class="hl-10">\n</span><span class="hl-3">&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1"> === </span><span class="hl-3">&#39;list&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><span class="hl-3">&#39;requestType&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1">, </span><span class="hl-3">&#39;request&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1">}) + </span><span class="hl-3">&quot;</span><span class="hl-10">\n</span><span class="hl-3">&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">            </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">out</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">        })</span><br/><br/><span class="hl-1">        </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;close&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;A client has disconnected.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><br/><span class="hl-1">        </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;error&#39;</span><span class="hl-1">, (</span><span class="hl-2">error</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Connection closed due to error: </span><span class="hl-6">${</span><span class="hl-2">error</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><br/><br/><span class="hl-1">    }).</span><span class="hl-5">listen</span><span class="hl-1">(</span><span class="hl-4">60300</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Waiting for clients to connect.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    })) {</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-5">Servidor</span><span class="hl-1">();</span><br/>
</code></pre>
<p>En el constructor de la clase Servidor, se crea un servidor, que se encarga de escuchar en el puerto 60300. </p>
<p>Añadí un manejador de eventos para el evento <strong>data</strong>, que se encarga de recibir los comandos que le envía el cliente, seguí para esto la lógica ya usada en otros ejercicios de la práctica, donde el final del mensaje viene indicado por un salto de línea <strong>\n</strong>. Una vez comprobado que el comando hace parte de los que controla la aplicación, se crea un <strong>ChildProcess</strong> que se encarga de ejecutar el programa <strong>index.js</strong> de la práctica anterior, con el comando y los argumentos que le envía el cliente.</p>
<p>Para lo anterior tuve que modificar un poco el funcionamiento de la practica anterior, definiendo que ahora los comandos los pasaría yo como una <strong>string</strong> y no los tomaría directamente el programa de la línea de comandos.</p>
<p>Controlé el evento <strong>data</strong> del <strong>stdout</strong> del <strong>ChildProcess</strong>, para ir guardando la salida del comando en una variable, cuando el proceso termina se emite el evento <strong>close</strong>, en el manejador de este evento se emite un evento <strong>request</strong>, en el manejador de dicho evento se encarga de enviar la información al cliente, en caso de que el comando sea incorrecto, se envía un mensaje de error, con el comando que ha fallado.</p>

<a href="#cliente" id="cliente" style="color: inherit; text-decoration: none;">
  <h3>Cliente</h3>
</a>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">chalk</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;chalk&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">net</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;net&#39;</span><span class="hl-1">;</span><br/><br/><br/><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-8">Cliente</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-2">mensaje</span><span class="hl-1">: </span><span class="hl-8">any</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">constructor</span><span class="hl-1">(</span><span class="hl-6">public</span><span class="hl-1"> </span><span class="hl-2">socket</span><span class="hl-1"> = </span><span class="hl-2">net</span><span class="hl-1">.</span><span class="hl-5">connect</span><span class="hl-1">({</span><span class="hl-2">port:</span><span class="hl-1"> </span><span class="hl-4">60300</span><span class="hl-1">})) {</span><br/><br/><span class="hl-1">        </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">argumentos</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">[] = []</span><br/><span class="hl-1">        </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">i</span><span class="hl-1"> = </span><span class="hl-4">3</span><span class="hl-1">; </span><span class="hl-2">i</span><span class="hl-1"> &lt; </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1">; </span><span class="hl-2">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">            </span><span class="hl-2">argumentos</span><span class="hl-1">.</span><span class="hl-5">push</span><span class="hl-1">(</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">i</span><span class="hl-1">])</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><span class="hl-3">&#39;comando&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-4">2</span><span class="hl-1">], </span><span class="hl-3">&#39;args&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-2">argumentos</span><span class="hl-1">}) + </span><span class="hl-3">&quot;</span><span class="hl-10">\n</span><span class="hl-3">&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">dataChunk</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">wholeData</span><span class="hl-1"> += </span><span class="hl-2">dataChunk</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">indexOf</span><span class="hl-1">(</span><span class="hl-3">&#39;</span><span class="hl-10">\n</span><span class="hl-3">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">messageLimit</span><span class="hl-1"> !== -</span><span class="hl-4">1</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">(</span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">substring</span><span class="hl-1">(</span><span class="hl-4">0</span><span class="hl-1">, </span><span class="hl-2">messageLimit</span><span class="hl-1">).</span><span class="hl-5">toString</span><span class="hl-1">());</span><br/><span class="hl-1">                </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">substring</span><span class="hl-1">(</span><span class="hl-2">messageLimit</span><span class="hl-1"> + </span><span class="hl-4">1</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-5">end</span><span class="hl-1">();</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        });</span><br/><br/><br/><span class="hl-1">        </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;end&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">requestType</span><span class="hl-1"> === </span><span class="hl-3">&#39;add&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">success</span><span class="hl-1"> === </span><span class="hl-3">&#39;success&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">chalk</span><span class="hl-1">.</span><span class="hl-5">green</span><span class="hl-1">(</span><span class="hl-3">`Funko </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">mensaje</span><span class="hl-9">.</span><span class="hl-2">idFunko</span><span class="hl-6">}</span><span class="hl-3"> agregado correctamente`</span><span class="hl-1">))</span><br/><span class="hl-1">                } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">chalk</span><span class="hl-1">.</span><span class="hl-5">red</span><span class="hl-1">(</span><span class="hl-3">`Funko </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">mensaje</span><span class="hl-9">.</span><span class="hl-2">idFunko</span><span class="hl-6">}</span><span class="hl-3"> no agregado`</span><span class="hl-1">))</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">requestType</span><span class="hl-1"> === </span><span class="hl-3">&#39;update&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">success</span><span class="hl-1"> === </span><span class="hl-3">&#39;success&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">chalk</span><span class="hl-1">.</span><span class="hl-5">green</span><span class="hl-1">(</span><span class="hl-3">`Funko </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">mensaje</span><span class="hl-9">.</span><span class="hl-2">idFunko</span><span class="hl-9">[</span><span class="hl-4">0</span><span class="hl-9">]</span><span class="hl-6">}</span><span class="hl-3"> actualizado correctamente`</span><span class="hl-1">))</span><br/><span class="hl-1">                } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">chalk</span><span class="hl-1">.</span><span class="hl-5">red</span><span class="hl-1">(</span><span class="hl-3">`Funko </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">mensaje</span><span class="hl-9">.</span><span class="hl-2">idFunko</span><span class="hl-9">[</span><span class="hl-4">0</span><span class="hl-9">]</span><span class="hl-6">}</span><span class="hl-3"> no actualizado`</span><span class="hl-1">))</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">requestType</span><span class="hl-1"> === </span><span class="hl-3">&#39;delete&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">success</span><span class="hl-1"> === </span><span class="hl-3">&#39;success&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">chalk</span><span class="hl-1">.</span><span class="hl-5">green</span><span class="hl-1">(</span><span class="hl-3">`Funko </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">mensaje</span><span class="hl-9">.</span><span class="hl-2">idFunko</span><span class="hl-9">[</span><span class="hl-4">0</span><span class="hl-9">]</span><span class="hl-6">}</span><span class="hl-3"> eliminado correctamente`</span><span class="hl-1">))</span><br/><span class="hl-1">                } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">chalk</span><span class="hl-1">.</span><span class="hl-5">red</span><span class="hl-1">(</span><span class="hl-3">`Funko </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">mensaje</span><span class="hl-9">.</span><span class="hl-2">idFunko</span><span class="hl-9">[</span><span class="hl-4">0</span><span class="hl-9">]</span><span class="hl-6">}</span><span class="hl-3"> no eliminado`</span><span class="hl-1">))</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">requestType</span><span class="hl-1"> === </span><span class="hl-3">&#39;read&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">success</span><span class="hl-1"> === </span><span class="hl-3">&#39;success&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">request</span><span class="hl-1">)</span><br/><span class="hl-1">                } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">chalk</span><span class="hl-1">.</span><span class="hl-5">red</span><span class="hl-1">(</span><span class="hl-3">`Funko </span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">mensaje</span><span class="hl-9">.</span><span class="hl-2">request</span><span class="hl-6">}</span><span class="hl-3"> no leido`</span><span class="hl-1">))</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">requestType</span><span class="hl-1"> === </span><span class="hl-3">&#39;list&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">request</span><span class="hl-1">)</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">mensaje</span><span class="hl-1">.</span><span class="hl-2">requestType</span><span class="hl-1"> === </span><span class="hl-3">&#39;error&#39;</span><span class="hl-1">){</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">chalk</span><span class="hl-1">.</span><span class="hl-5">red</span><span class="hl-1">(</span><span class="hl-3">`</span><span class="hl-6">${</span><span class="hl-6">this</span><span class="hl-9">.</span><span class="hl-2">mensaje</span><span class="hl-9">.</span><span class="hl-2">request</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">))</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        })</span><br/><br/><span class="hl-1">        </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;error&#39;</span><span class="hl-1">, (</span><span class="hl-2">error</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Connection closed due to error: </span><span class="hl-6">${</span><span class="hl-2">error</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><br/><br/><span class="hl-1">}</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">client</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-5">Cliente</span><span class="hl-1">();</span><br/>
</code></pre>
<p>En el contructor del Cliente defino que se conecte al puerto 60300. Mando por el Socket el comando y los argumentos que recibo por la línea de comandos. A continuación, controlé el evento <strong>data</strong>, que se encarga de recibir la información que envía el servidor, en este caso, la información que envía el servidor es un <strong>JSON</strong> con la información del comando que se ejecutó, por lo que lo parseo y lo guardo en una variable. Una vez que se recibe el mensaje completo, se emite el evento <strong>end</strong>.</p>
<p>En el manejador del evento <strong>end</strong>, se encarga de imprimir por pantalla la información que se ha recibido del servidor, es aquí donde se añade el color de la salida haciendo uso de la librería <strong>chalk</strong>.</p>
<p>Se incluyen todos los manejadores necesarios para el control de errores.</p>

<a href="#ejercicio-pe" id="ejercicio-pe" style="color: inherit; text-decoration: none;">
  <h2>Ejercicio PE</h2>
</a>
<p>Para finalizar la práctica, explicaré brevemente el ejercicio solicitado en la clase PE, se debía desarrollar un sistema cliente-servidor donde el cliente solicitará al servidor la ejecución de un comando, el servidor ejecutará el comando y devolverá la salida al cliente.</p>
<p>Este ejercicio es sin duda el ejercicio que más me ha costado de toda la parte PE de la asignatura, en algún momento pensé que no lo iba a poder hacer y pensé en retirarme, pero por fortuna, al final conseguí que funcionara, definitivamente no es mi mejor código, pero me salvó de un suspenso.</p>

<a href="#servidor-1" id="servidor-1" style="color: inherit; text-decoration: none;">
  <h3>Servidor</h3>
</a>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">net</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;net&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">watchFile</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">spawn</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;child_process&#39;</span><span class="hl-1">;</span><br/><br/><br/><span class="hl-2">net</span><span class="hl-1">.</span><span class="hl-5">createServer</span><span class="hl-1">((</span><span class="hl-2">connection</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;A client has connected.&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">comando</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">wholeData</span><span class="hl-1"> += </span><span class="hl-2">comando</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">indexOf</span><span class="hl-1">(</span><span class="hl-3">&#39;</span><span class="hl-10">\n</span><span class="hl-3">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">while</span><span class="hl-1"> (</span><span class="hl-2">messageLimit</span><span class="hl-1"> !== -</span><span class="hl-4">1</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">message</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">(</span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">substring</span><span class="hl-1">(</span><span class="hl-4">0</span><span class="hl-1">, </span><span class="hl-2">messageLimit</span><span class="hl-1">).</span><span class="hl-5">toString</span><span class="hl-1">());</span><br/><span class="hl-1">      </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">substring</span><span class="hl-1">(</span><span class="hl-2">messageLimit</span><span class="hl-1"> + </span><span class="hl-4">1</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cat</span><span class="hl-1"> = </span><span class="hl-5">spawn</span><span class="hl-1">(</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-2">comando</span><span class="hl-1">, </span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-2">args</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">cat</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">.</span><span class="hl-5">pipe</span><span class="hl-1">(</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">out</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><br/><span class="hl-1">      </span><span class="hl-2">cat</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">piece</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">out</span><span class="hl-1"> += </span><span class="hl-2">piece</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">cat</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;close&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><span class="hl-3">&#39;salida&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-2">out</span><span class="hl-1">}) + </span><span class="hl-3">&quot;</span><span class="hl-10">\n</span><span class="hl-3">&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">      </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">indexOf</span><span class="hl-1">(</span><span class="hl-3">&#39;</span><span class="hl-10">\n</span><span class="hl-3">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  })</span><br/><br/><span class="hl-1">  </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;close&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;A client has disconnected.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}).</span><span class="hl-5">listen</span><span class="hl-1">(</span><span class="hl-4">60300</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Waiting for clients to connect.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/>
</code></pre>
<p>Para el servidor cree un server y dentro añadí un manejador del evento <strong>data</strong> donde reuní toda la información que me pasaba el cliente y mediante un salto de línea, separamos los comandos que nos envía el cliente. Una vez que tenemos el comando, creamos un <strong>Child Process</strong> que ejecutará el comando y los argumentos que nos envía el cliente. La salida del comando la vamos guardando en una variable y cuando el proceso hijo se cierre, enviamos la salida al cliente en modo JSON.</p>

<a href="#cliente-1" id="cliente-1" style="color: inherit; text-decoration: none;">
  <h3>Cliente</h3>
</a>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">net</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;net&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">client</span><span class="hl-1"> = </span><span class="hl-2">net</span><span class="hl-1">.</span><span class="hl-5">connect</span><span class="hl-1">({</span><span class="hl-2">port:</span><span class="hl-1"> </span><span class="hl-4">60300</span><span class="hl-1">});</span><br/><br/><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">lista</span><span class="hl-1"> = []</span><br/><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">i</span><span class="hl-1"> = </span><span class="hl-4">3</span><span class="hl-1">; </span><span class="hl-2">i</span><span class="hl-1"> &lt; </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1">; </span><span class="hl-2">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">  </span><span class="hl-2">lista</span><span class="hl-1">.</span><span class="hl-5">push</span><span class="hl-1">(</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-2">i</span><span class="hl-1">])</span><br/><span class="hl-1">}</span><br/><br/><br/><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><span class="hl-3">&#39;comando&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-4">2</span><span class="hl-1">], </span><span class="hl-3">&#39;args&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-2">lista</span><span class="hl-1">}) + </span><span class="hl-3">&quot;</span><span class="hl-10">\n</span><span class="hl-3">&quot;</span><span class="hl-1">)</span><br/><br/><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">dataChunk</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">wholeData</span><span class="hl-1"> += </span><span class="hl-2">dataChunk</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">indexOf</span><span class="hl-1">(</span><span class="hl-3">&#39;</span><span class="hl-10">\n</span><span class="hl-3">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">while</span><span class="hl-1"> (</span><span class="hl-2">messageLimit</span><span class="hl-1"> !== -</span><span class="hl-4">1</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">message</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">(</span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">substring</span><span class="hl-1">(</span><span class="hl-4">0</span><span class="hl-1">, </span><span class="hl-2">messageLimit</span><span class="hl-1">).</span><span class="hl-5">toString</span><span class="hl-1">());</span><br/><span class="hl-1">      </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">substring</span><span class="hl-1">(</span><span class="hl-2">messageLimit</span><span class="hl-1"> + </span><span class="hl-4">1</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-2">salida</span><span class="hl-1">)</span><br/><span class="hl-1">      </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-5">indexOf</span><span class="hl-1">(</span><span class="hl-3">&#39;</span><span class="hl-10">\n</span><span class="hl-3">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;end&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">message</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">(</span><span class="hl-2">wholeData</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/>
</code></pre>
<p>Por la parte del cliente, nos conectamos al puerto 60300 y enviamos el comando y los argumentos que nos pasan por la línea de comandos en modo JSON. Luego a través de un manejador del evento <strong>data</strong>, vamos recibiendo la información que nos envía el servidor y la vamos guardando en una variable. Una vez que tenemos toda la información, la parseamos y la imprimimos por pantalla.</p>

<a href="#conclusiones" id="conclusiones" style="color: inherit; text-decoration: none;">
  <h2>Conclusiones</h2>
</a>
<p>Esta ha sido una practica que en todo momento pensé en renunciar a ella, debido a que tengo muy poco tiempo por tema trabajo y clases, pero al final conseguí sacar el tiempo sufiente para hacerla, aunque debo reconocer que no es mi mejor código, pero me ha servidor para aprender a usar los sockets y distintos eventos que se pueden usar.</p>
<p>Sobretodo destacar el miedo que tuve en la hora del PE, donde hasta los últimos diez minutos, nada me funcionaba, me sentía muy frustrado, pero al final debo admitir que eso me permitió aprender bastante del funcionamiento que luego me ayudo a hacer toda la práctica mucho más rapido.</p>

<a href="#referencias" id="referencias" style="color: inherit; text-decoration: none;">
  <h2>Referencias</h2>
</a>
<ul>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/nodejs-sockets.html">Sockets</a></li>
</ul>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">ull-<wbr/>esit-<wbr/>inf-<wbr/>dsi-<wbr/>22-<wbr/>23-<wbr/>prct09-<wbr/>funko-<wbr/>app-<wbr/>Daniel<wbr/>Felipe<wbr/>Gomez</a>
<ul>
<li class="tsd-kind-module"><a href="modules/ejercicio_2_info_fichero_con_pipe.html">ejercicio-<wbr/>2/info_<wbr/>fichero_<wbr/>con_<wbr/>pipe</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_2_info_fichero_sin_pipe.html">ejercicio-<wbr/>2/info_<wbr/>fichero_<wbr/>sin_<wbr/>pipe</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3.html">ejercicio-<wbr/>3</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_client.html">ejercicio-<wbr/>3/client</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_entities_funko.html">ejercicio-<wbr/>3/entities/funko</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_enumerables_genero_funko_enum.html">ejercicio-<wbr/>3/enumerables/genero_<wbr/>funko_<wbr/>enum</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_enumerables_tipo_funko_enum.html">ejercicio-<wbr/>3/enumerables/tipo_<wbr/>funko_<wbr/>enum</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_handler_manejadorJSON.html">ejercicio-<wbr/>3/handler/manejadorJSON</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_handler_menuFunko.html">ejercicio-<wbr/>3/handler/menu<wbr/>Funko</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_interfaces_funko_interface.html">ejercicio-<wbr/>3/interfaces/funko_<wbr/>interface</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_interfaces_funko_json_interface.html">ejercicio-<wbr/>3/interfaces/funko_<wbr/>json_<wbr/>interface</a></li>
<li class="tsd-kind-module"><a href="modules/ejercicio_3_server.html">ejercicio-<wbr/>3/server</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>